!function o(i,l,c){function s(e,t){if(!l[e]){if(!i[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(u)return u(e,!0);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}var r=l[e]={exports:{}};i[e][0].call(r.exports,function(t){return s(i[e][1][t]||t)},r,r.exports,o,i,l,c)}return l[e].exports}for(var u="function"==typeof require&&require,t=0;t<c.length;t++)s(c[t]);return s}({1:[function(t,e,n){"use strict";var u={},i=null;function a(){layui.use("form",function(){var t=layui.form,e="";u.position&&u.position.lng&&u.position.lat&&(e=u.position.lng+","+u.position.lat),t.val("searchForm",{companyname:u.company||"",address:u.addr||"",position:e||"",district:u.district||"",city:u.city||"苏州市"}),t.on("submit(search)",function(t){var e,n,a,r=t.field,o="";return o="companyname"==r.searchType?r.companyname:r.address,i&&(e=o,n=layer.load(2),(a=new BMap.LocalSearch(i,{renderOptions:{map:i},onSearchComplete:function(t){layer.close(n),a.getStatus()==BMAP_STATUS_SUCCESS&&t&&t.getCurrentNumPois()&&0<t.getCurrentNumPois()?layer.msg("加载完成！",{time:1e3,offset:"50%"}):layer.msg("在苏州市没有找到相关的地点。")}})).search(e)),!1}),t.on("submit(commit)",function(t){$("#commitData").attr("disabled","true");var e,n,a,r,o,i=t.field;if(i.position){var l=i.position.split(","),c=i.city||u.city,s=i.district||u.district;l&&1<l.length?(e=l[0],n=l[1],a=c,r=s,o=layer.load(2),$.ajax({url:"/manage/updateCompanyPosition",type:"post",data:{_id:u._id,lat:n,lng:e,city:a,district:r}}).done(function(t){if(layer.close(o),!!t&!!t.n&&0<t.n){layer.msg("坐标数据已提交");try{parent.layer.close(parent.layer.getFrameIndex(window.name)),parent.layui.table.reload("compnayList")}catch(t){}}else layer.msg("提交数据执行失败，原因：未匹配的记录");$("#commitData").removeAttr("disabled")}).fail(function(t){layer.close(o),console.error(t),layer.msg("数据提交失败"),$("#commitData").removeAttr("disabled")})):(layer.msg("提交数据格式不正确"),$("#commitData").removeAttr("disabled"))}else layer.msg("请先点选一个位置"),$("#commitData").removeAttr("disabled");return!1}),t.render()})}$(function(){var t,e,n=(t=new RegExp("(^|&)"+"_id"+"=([^&]*)(&|$)","i"),null!=(e=window.location.search.substr(1).match(t))?unescape(e[2]):null);n?$.ajax({url:"/manage/getcompanyById?_id="+n,type:"get",data:{}}).done(function(t){u=t,a(),setTimeout(function(){$(".btn-search").click()},500)}).fail(function(t){console.error("数据查询超时")}):a(),function(){(i=new BMap.Map("allmap")).centerAndZoom(new BMap.Point(120.621233,31.335415),13);var t=new BMap.NavigationControl;i.addControl(t),i.setCurrentCity("苏州"),i.enableScrollWheelZoom(!0),i.setDefaultCursor("auto"),i.addEventListener("click",function(t){$("input[name=position]").val(t.point.lng+","+t.point.lat)})}()})},{}]},{},[1]);