!function t(e,n,r){function a(i,l){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!l&&c)return c(i,!0);if(o)return o(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(t){var n=e[i][1][t];return a(n||t)},u,u.exports,t,e,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(t,e,n){"use strict";function r(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(e);return null!=n?unescape(n[2]):null}function a(){layui.use("form",function(){var t=layui.form,e="";c.position&&c.position.lng&&c.position.lat&&(e=c.position.lng+","+c.position.lat),t.val("searchForm",{companyname:c.company||"",address:c.addr||"",position:e||"",district:c.district||"",city:c.city||"苏州市"}),t.on("submit(search)",function(t){var e=t.field,n="";return n="companyname"==e.searchType?e.companyname:e.address,s&&l(n),!1}),t.on("submit(commit)",function(t){$("#commitData").attr("disabled","true");var e=t.field;if(e.position){var n=e.position.split(","),r=e.city||c.city,a=e.district||c.district;n&&n.length>1?o(n[0],n[1],r,a):(layer.msg("提交数据格式不正确"),$("#commitData").removeAttr("disabled"))}else layer.msg("请先点选一个位置"),$("#commitData").removeAttr("disabled");return!1}),t.render()})}function o(t,e,n,r){var a=layer.load(2);$.ajax({url:"/manage/updateCompanyPosition",type:"post",data:{_id:c._id,lat:e,lng:t,city:n,district:r}}).done(function(t){if(layer.close(a),!!t&!!t.n&&t.n>0){layer.msg("坐标数据已提交");try{parent.layer.close(parent.layer.getFrameIndex(window.name)),parent.layui.table.reload("compnayList")}catch(t){}}else layer.msg("提交数据执行失败，原因：未匹配的记录");$("#commitData").removeAttr("disabled")}).fail(function(t){layer.close(a),console.error(t),layer.msg("数据提交失败"),$("#commitData").removeAttr("disabled")})}function i(){function t(t){$("input[name=position]").val(t.point.lng+","+t.point.lat)}s=new BMap.Map("allmap"),s.centerAndZoom(new BMap.Point(120.621233,31.335415),13);var e=new BMap.NavigationControl;s.addControl(e),s.setCurrentCity("苏州"),s.enableScrollWheelZoom(!0),s.setDefaultCursor("auto"),s.addEventListener("click",t)}function l(t){var e=layer.load(2),n=new BMap.LocalSearch(s,{renderOptions:{map:s},onSearchComplete:function(t){layer.close(e),n.getStatus()==BMAP_STATUS_SUCCESS&&t&&t.getCurrentNumPois()&&t.getCurrentNumPois()>0?layer.msg("加载完成！",{time:1e3,offset:"50%"}):layer.msg("在苏州市没有找到相关的地点。")}});n.search(t)}var c={},s=null;$(function(){var t=r("_id");$.ajax({url:"/manage/getcompanyById?_id="+t,type:"get",data:{}}).done(function(t){c=t,a(),setTimeout(function(){$(".btn-search").click()},500)}).fail(function(t){console.error("数据查询超时")}),i()})},{}]},{},[1]);